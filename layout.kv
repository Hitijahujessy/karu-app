#: kivy 2.1.0
#: import WipeTransition kivy.uix.screenmanager.WipeTransition
#:import hex kivy.utils.get_color_from_hex
#: import JsonStore kivy.storage.jsonstore
#: import Clock kivy.clock.Clock
#: import data packData
#coding: -*- utf-8 -*-
<Label>:
    font_name: 'SourceHanSansHW-Bold.otf'
<Button>:
    font_name: 'SourceHanSansHW-Bold.otf'


<WindowManager>:
    transition: WipeTransition()
    canvas.before:
        Color:
            rgba: 1, 1, 1, 1
        Rectangle:
            pos: self.pos
            size: self.size
    Menu:
        id: mainmenu
    GameWidget:
        id: gw
    KaruHouse:
        id: kh
    SettingsScreen:
        id: settings


<Menu>:
    id: menu
    name: "first"
    orientation: 'vertical'
    size: root.width, root.height
    secondary_color: .4,.4,.4,1
    secondary_color2: 0,.7,.7,1
    #gw: app.root.ids.gw
    #highscore_menu: root.label_highscore
    #wallet_menu: root.label_wallet
    canvas.before:
        Color:
            rgba: 1, 1, 1, 1
        Rectangle:
            pos: self.pos
            size: self.size


    Button:
	    id: start_button
        text: "Start"
        font_size: 32
        on_press: app.root.ids.gw.second_color(); app.root.ids.gw.reload();
        on_release: app.root.current = "second"; Clock.schedule_interval(app.root.ids.gw.countdown, .5)
        size_hint: .2, .12
        pos_hint: {"center_x": .4925, "center_y": .435}
        background_color: 0, 0, 0, 0
        canvas.after:
            Color:
                rgba: 1 - root.main_color[0], 1 - root.main_color[1], 1 - root.main_color[2], .9
            RoundedRectangle:
                size: start_button.width, start_button.height
                pos: start_button.pos
            Color:
                rgba: 1,1,1,1
            RoundedRectangle:
                size: self.width/1.5, self.height/1.5
                pos: self.center_x*.875, self.center_y*.9
                source: 'resources/icons/play.png'

    Button:
	    id: ruma_button
        text: "Karu's huis"
        font_size: 32
        on_release: app.root.current = 'third'
        size_hint: .2, .12
        pos_hint: {"center_x": .4925, "center_y": .3}
        background_color: 0, 0, 0, 0
        canvas.after:
            Color:
                rgba: 1 - root.main_color[0], 1 - root.main_color[1], 1 - root.main_color[2], .9
            RoundedRectangle:
                size: ruma_button.width, ruma_button.height
                pos: ruma_button.pos
            Color:
                rgba: 1,1,1,1
            RoundedRectangle:
                size: self.width/1.5, self.height/1.5
                pos: self.center_x*.865, self.center_y*.85
                source: 'resources/icons/shop.png'
    Button:
	    id: settings_button
        text: "Instellingen"
        font_size: 32
        on_release: app.root.current = 'fourth'
        size_hint: .2, .12
        pos_hint: {"center_x": .4925, "center_y": .165}
        background_color: 0, 0, 0, 0
        canvas.after:
            Color:
                rgba: 1 - root.main_color[0], 1 - root.main_color[1], 1 - root.main_color[2], .9
            RoundedRectangle:
                size: settings_button.width, settings_button.height
                pos: settings_button.pos
            Color:
                rgba: 1,1,1,1
            RoundedRectangle:
                size: self.width/1.5, self.height/1.5
                pos: self.center_x*.865, self.center_y*.75
                source: 'resources/icons/settings.png'
    Image:
        source: 'resources/karu/logo_head.png'
        size_hint: .75, .75
        pos_hint: {'center_x': .5, 'center_y': .8}
        canvas.before:
            Color:
                rgba: 1 - root.main_color[0], 1 - root.main_color[1], 1 - root.main_color[2], .9
            RoundedRectangle:
                size: self.width, self.height*.6
                pos: self.x, self.y*1.35
                source: 'resources/karu/logo_rect.png'
    Image:
        source: 'resources/karu/logo_txt.png'
        size_hint: .75, .75
        pos_hint: {'center_x': .5, 'center_y': .8}
    Label:
        size_hint: .5, .1
        pos_hint: {'center_x': .5, 'center_y': .6}
        canvas.before:
            Color:
                rgba: 1 - root.main_color[0], 1 - root.main_color[1], 1 - root.main_color[2], .9
            RoundedRectangle:
                size: self.size
                pos: self.pos

    Label:
        id: highscore_menu
        text: str(round(root.highscore))
        font_size: 36
        bold: True
        pos_hint: {'center_x': .55, 'center_y': .62}

    Label:
        id: wallet_menu
        text: str(round(root.wallet))
        bold: True
        pos_hint: {'center_x': .55, 'center_y': .58}

    Image:
        size_hint: .07, .07
        pos_hint: {'center_x': .45, 'center_y': .58}
        source: 'resources/icons/karucoins.png'

    Image:
        size_hint: .07, .07
        pos_hint: {'center_x': .45, 'center_y': .62}
        source: 'resources/icons/crown.png'


<LetterButton@Button>
    background_color: 0,0,0,0  # the last zero is the critical on, make invisible
    secondary_color2: 0,.7,.7,.8
    on_press: self.state=='down'
    opacity: 0
#    canvas.before:
#        Color:
#            rgba: ((249/255), (193/255), (109/255), .8) if self.state=='normal' else (0,.7,.7,.8)  # visual feedback of press
#        RoundedRectangle:
#            pos: self.pos
#            size: self.size

<WordButton@Button>:
    text: '_'
    bold: True
    font_size: 42
    background_color: 0, 0, 0, 0
    disabled_color: 0, 0, 0, 0
    charpos: app.root.ids.gw.charpos
    on_press: self.text = '_'; app.root.ids.gw.charpos==self.charpos; app.root.ids.gw.backspace()
    on_release: self.state='down'
    size_hint: .2, .2
#    canvas.before:
#        Color:
#            rgba: ((249/255), (193/255), (109/255), .8) if self.state=='normal' else (0,.7,.7,.8)  # visual feedback of press
#        RoundedRectangle:
#            pos: self.pos
#            size: self.size

#:import Factory kivy.factory.Factory
<PopupFinish@Popup>
    auto_dismiss: False
    separator_color: 0, 0, 0, 0
    background_color: 0, 0, 0, 0
    size_hint_y: .8
    size_hint_x: .9
    title: ""
    secondary_color: ((255/255), (167/255), 0, 1)
    secondary_color2: 0,.7,.7,1
    gw: app.root.ids.gw


    on_open: app.root.ids.gw.count_coins_anim(self.ids.karucoin); app.root.ids.gw.new_best_sound() if app.root.ids.gw.broke_record==True else print('')

    FloatLayout:
        size: app.root.size

        Label:
            font_size: 48
            pos_hint: {'center_x':.375, 'y':.52}
            canvas.before:
                Color:
                    rgba: 1 - app.root.ids.gw.main_color[0], 1 - app.root.ids.gw.main_color[1], 1 - app.root.ids.gw.main_color[2], 1
                RoundedRectangle:
                    pos: self.pos
                    size: self.width*1.25, self.height*.85
                    source: "resources/icons/banner.png"

        Label:
            text: str(root.gw.highscore)
            font_size: 48
            pos_hint: {'center_x':.5, 'y':.495}
            canvas.after:
                Color:
                Color:
                    rgba: 1,1,1,1
                RoundedRectangle:
                    size: self.width*.1, self.height*.0625
                    pos: self.x*5.5, self.y*1.7979
                    source: 'resources/icons/crown.png'
        Label:
            text: "New Best!" if root.gw.broke_record==True else "Score:"
            valign: 'middle'
            font_size: 42
            pos_hint: {'center_x':.5, 'y':.255}
        Image:
            source:'resources/icons/crown.png'
            pos_hint: {'center_x':.5, 'y':.75}
            size_hint: .12, .125
            opacity: 1 if root.gw.broke_record==True else 0
        Label:
            text: ' {}   >   {}'.format(root.gw.highscore, root.gw.old_highscore) if root.gw.broke_record==True else " {}".format(root.gw.score)
            valign: 'middle'
            font_size: 57
            pos_hint: {'center_x':.475, 'y':.18}
        Label:
            text: '{}'.format(root.gw.new_wallet)
            font_size: 57
            valign: 'middle'
            pos_hint: {'center_x':.5, 'y':.0625}
        Image:
            id: karucoin
            size_hint: .08, .08
            pos_hint: {'center_x': .875, 'y': 1.07}
            source: 'resources/icons/karucoin_single.png'
            opacity: 0
        Button:
            text: ''
            on_press: root.gw.reload(); Clock.schedule_interval(app.root.ids.gw.countdown, .5)
            on_release:  root.dismiss()
            font_size: 32
            size_hint: .2, .12
            pos_hint: {'center_x':.5, 'y':.25}
            background_color: 0, 0, 0, 0
            canvas.after:
                Color:
                    rgba: 1 - app.root.ids.gw.main_color[0], 1 - app.root.ids.gw.main_color[1], 1 - app.root.ids.gw.main_color[2], 1
                RoundedRectangle:
                    size: self.size
                    pos: self.pos
                Color:
                    rgba: 1,1,1,.8
                RoundedRectangle:
                    size: self.width/1.2, self.height/1.2
                    pos: self.width/.387, self.height/.285
                    source: 'resources/icons/reload.png'
        Button:
            on_release: root.gw.reload(); root.dismiss(); app.root.current = 'first'
            size_hint: .2, .12
            pos_hint: {'center_x':.5, 'y':.05}
            background_color: 0, 0, 0, 0
            canvas.after:
                Color:
                    rgba: 1 - app.root.ids.gw.main_color[0], 1 - app.root.ids.gw.main_color[1], 1 - app.root.ids.gw.main_color[2], 1
                RoundedRectangle:
                    size: self.size
                    pos: self.pos
                Color:
                    rgba: 1,1,1,.8
                RoundedRectangle:
                    size: self.width/1.2, self.height/1.2
                    pos: self.width/.387, self.height/.545
                    source: 'resources/icons/home.png'

<PopupMenu@Popup>
    auto_dismiss: False
    size_hint_y: .8
    size_hint_x: .9
    title: ""
    separator_color: [1 - app.root.ids.gw.main_color[0], 1 - app.root.ids.gw.main_color[1], 1 - app.root.ids.gw.main_color[2], .75]
    gw: app.root.ids.gw
    main_color: self.gw.main_color
    secondary_color2: 0,.7,.7,1

    FloatLayout:
        Label:
            text: f"Level %d/10" % (app.root.ids.gw.level + 1)
            bold: True
            font_size: 36
            size_hint: .9, .25
            pos_hint: {'x':.05, 'y':.70}
            canvas.before:
                RoundedRectangle:
                    size: root.size
                    pos: root.pos

        Button:
            on_press: root.gw.early_stop = 1; print('early stop')
            on_release: root.gw.stop_time(); root.dismiss(); app.root.current = 'first'#; app.root.ids.mainmenu.highscore_menu.text = str(root.gw.highscore); app.root.ids.mainmenu.wallet_menu.text = str(root.gw.wallet)
            font_size: 32
            size_hint: .2, .12
            pos_hint: {'center_x': .5, 'y':.25}
            background_color: 0, 0, 0, 0
            canvas.before:
                Color:
                    rgba: [1 - app.root.ids.gw.main_color[0], 1 - app.root.ids.gw.main_color[1], 1 - app.root.ids.gw.main_color[2], 1] if self.state=='normal' else root.secondary_color2
                RoundedRectangle:
                    size: self.size
                    pos: self.pos
                Color:
                    rgba: 1,1,1,1
                RoundedRectangle:
                    size: self.width/1.2, self.height/1.2
                    pos: self.width/.385, self.height/.28
                    source: 'resources/icons/home.png'
        Button:
            text: ''
            on_press: root.gw.game_pause = False
            on_release:  root.dismiss(); root.gw.pause_time()
            font_size: 32
            size_hint: .2, .12
            pos_hint: {'center_x': .5, 'y':.4}
            background_color: 0, 0, 0, 0
            canvas.before:
                Color:
                    rgba: [1 - app.root.ids.gw.main_color[0], 1 - app.root.ids.gw.main_color[1], 1 - app.root.ids.gw.main_color[2], 1] if self.state=='normal' else root.secondary_color2
                RoundedRectangle:
                    size: self.size
                    pos: self.pos
                Color:
                    rgba: 1,1,1,1
                RoundedRectangle:
                    size: self.width/1.5, self.height/1.5
                    pos: self.width/.375, self.height/.205
                    source: 'resources/icons/play.png'


<BackgroundButton@ToggleButton>:
    group: 'bg_buttons'
    text: ''
    bold: True
    background_color: 0, 0, 0, 0
    backgroundnumber: 1
    disabled: True if self.state=='down' else False
    size_hint_x: .5
    size_hint_y: None
    height: 180

    canvas.before:
        Color:
            rgba: (1,1,1,1)# if self.state=='normal' else (1,1,1,.4)
        RoundedRectangle:
            size: self.width, self.height
            pos: self.pos
            source: ('resources/backgrounds/wallpaper%s.png' % self.backgroundnumber) if self.backgroundnumber > 1 else 'resources/backgrounds/wallpaper.png'
    canvas.after:
        Color:
            rgba: (0, 0, 0, 0) if self.state=='normal' else (1,1,1,1)
        Line:
            width: 3
            rectangle: self.x, self.y, self.width, self.height
#        RoundedRectangle:
#            size: self.width, self.height
#            pos: self.pos


    Button:
        id: lock_button
        on_press: print('Locked')
        size: root.size
        pos: root.pos
        background_color: 0, 0, 0, 0
        canvas.after:
            Color:
                rgba: (0, 0, 0, .75)
            RoundedRectangle:
                size: self.width, self.height
                pos: self.pos


    Image:
        id: lock_img
        pos: root.x+5, root.center_y+40
        size: 40, 40
        source: 'resources/icons/padlock.png'


<BuyButton@Button>:
    text: '   250'
    bold: True
    background_color: 0, 0, 0, 0
    backgroundnumber_buy: 1
    #on_press: print(self.backgroundnumber_buy)
    size_hint_y: None
    height: 80


    canvas.before:
        Color:
            rgba: (.4,.4,.4,1) if self.state=='normal' else (0,.7,.7,1)
        RoundedRectangle:
            size: self.width, self.height
            pos: self.pos
    Image:
        id: coin_icon
        source: 'resources/icons/karucoin_single.png' if self.disabled==False else 'resources/icons/check.png'
        size: 50, 50
        pos: (root.x, root.y+15) if self.disabled==False else (root.x+40, root.y+15)
        pos_hint: {'x':1, 'y':1}


#: import Clock kivy.clock.Clock
<PopupBg>:
    id: popupbg
    size_hint_y: .65
    size_hint_x: .8
    separator_color: [1 - app.root.ids.gw.main_color[0], 1 - app.root.ids.gw.main_color[1], 1 - app.root.ids.gw.main_color[2], .75]
    background_color: 0, 0, 0, 0
    size_hint_y: .8
    size_hint_x: .9
    secondary_color: ((255/255), (167/255), 0, 1)
    secondary_color2: 0,.7,.7,1
    gw: app.root.ids.gw
    on_dismiss: app.root.ids.mainmenu.second_color()#; app.root.ids.gw.second_color()

    #kh: app.root.ids.kh
    #title: ('KaruCoins: ' + str(round(self.wallet)))


<PopupPacks>:
    id: popuppacks
    size_hint_y: .5
    size_hint_x: .8
    kh: app.root.ids.kh
    #current_pack:
    title: ''#('KaruCoins: ' + str(round(self.wallet)))
    #pack_name: ''


    FloatLayout:
        size_hint: .25, .6
        pos_hint: {"x": 1, "y": .35}

        Button:
            id: house_icon
            on_press: house_pack.state = "down"; root.current_pack="resources/packs/huis/wordlist_house.csv" ; root.pack_switch()
            size_hint: .35, .5
            pos_hint: {"center_x": .25, "y": .5}
            background_color: 0, 0, 0, 0
            canvas.before:
                Color:
                    rgba: (1, 1, 1, 1)
                Rectangle:
                    pos: self.pos
                    size: self.size
                    source: "resources/icons/house_pack_icon.png"
        Button:
            id: animal_icon
            disabled: False if root.ids.animal_unlock.value==10 else True
            pos_hint: {"center_x": .75, "y": .5}
            on_press: animal_pack.state = "down"; root.current_pack="resources/packs/dieren/wordlist_animals.csv" ; root.pack_switch()
            size_hint: .35, .5
            background_color: 0, 0, 0, 0
            canvas.before:
                Color:
                    rgba: (1, 1, 1, 1) if self.disabled==False else (.8, .8, .8, .5)
                Rectangle:
                    pos: self.pos
                    size: self.size
                    source: "resources/icons/animal_pack_icon.png"
        CheckBox:
            id: house_pack
            group: "packs"
            on_press: root.current_pack="resources/packs/huis/wordlist_house.csv" ; root.pack_switch()
            state: "down" if root.current_pack=="resources/packs/huis/wordlist_house.csv" else "normal"
            size_hint: .2, .2
            pos_hint: {"center_x": .25, "center_y": .35}

        CheckBox:
            id: animal_pack
            group: "packs"
            disabled: False if root.ids.animal_unlock.value==10 else True
            on_press: root.current_pack="resources/packs/dieren/wordlist_animals.csv" ; root.pack_switch()
            state: "down" if root.current_pack=="resources/packs/dieren/wordlist_animals.csv" else "normal"
            size_hint: .2, .2
            pos_hint: {"center_x": .75, "center_y": .35}
        ProgressBar:
            id: animal_unlock
            max: 10
            value: app.root.ids.gw.correct_words
            size_hint: .4, .5
            pos_hint: {"center_x": .75, "center_y": .25}
#            canvas.after:
#                Color:
#                    rgba: [1 - app.root.ids.gw.main_color[0], 1 - app.root.ids.gw.main_color[1], 1 - app.root.ids.gw.main_color[2], 1]
#                BorderImage:
#                    border: (12, 12, 12, 12)
#                    pos: self.x, self.center_y - 12
#                    size: self.width, 24
#                    #source: 'blue.png'
#                Color:
#                    rgba: 1, 0, 0, 1
#                BorderImage:
#                    border: [int(min(self.width * (self.value / float(self.max)) if self.max else 0, 12))] * 4
#                    pos: self.x, self.center_y - 12
#                    size: self.width * (self.value / float(self.max)) if self.max else 0, 24
#                    #source: 'red.png'




<PopupOutfit@Popup>:
    size_hint_y: .5
    size_hint_x: .8
    kh: app.root.ids.kh
    title: ''#('KaruCoins: ' + str(round(self.wallet)))

    BoxLayout:
        spacing: 15
        Button:
            text: "Coming soon..."
            bold: True
            on_press: print('COMING SOON')
            font_size: 32
            size: root.width/6, root.height/4
            size_hint: None, None
            pos: root.width/4, root.height/1.5
            background_color: 0, 0, 0, .7



<GameWidget>:

    size: root.size
    pos: root.pos
    bg: self.bg
    canvas.before:
        Color:
            rgba: 1, 1, 1, 1
        Rectangle:
            pos: self.pos
            size: self.size
            source: self.bg

    name: "second"

    highscore_label: highscore_label
    wallet_label: wallet_label



    letterBtn1: LetterBtn1
    letterBtn2: LetterBtn2
    letterBtn3: LetterBtn3
    letterBtn4: LetterBtn4
    letterBtn5: LetterBtn5
    letterBtn6: LetterBtn6
    letterBtn7: LetterBtn7
    letterBtn8: LetterBtn8
    letterBtn9: LetterBtn9
    letterBtn10: LetterBtn10
    letterBtn11: LetterBtn11
    letterBtn12: LetterBtn12
    letterBtn13: LetterBtn13
    letterBtn14: LetterBtn14
    letterBtn15: LetterBtn15
    letterBtn16: LetterBtn16
    letterBtn17: LetterBtn17
    letterBtn18: LetterBtn18

    next_button: next_button

    help_button: help_button
    cd_label: cd_label

    imagewidget: imagewidget
    mainlanglabel: mainlanglabel

    i: 0

    id: AmbonWidget
    main_color: AmbonWidget.main_color
    secondary_color: (1 - AmbonWidget.main_color[0], 1 - AmbonWidget.main_color[1], 1 - AmbonWidget.main_color[2], .8)
    secondary_color2: 0,.7,.7,1




    Label:
        id: score_label
        pos_hint: {'x': .868, 'y': .938}
        size: root.size
        text_size: self.width, self.height
        color: 1, 1, 1
        bold: True
        spacing: 3
        text: str(round(AmbonWidget.score))
        background_color: 0, 0, 0, 0
        canvas.before:
            Color:
                rgba: 1 - AmbonWidget.main_color[0], 1 - AmbonWidget.main_color[1], 1 - AmbonWidget.main_color[2], .9
            RoundedRectangle:
                pos: root.width/1.3, root.height/1.15
                size: root.width/5, root.height/9

    Label:
        id: highscore_label
        pos_hint: {'x': .868, 'y': .878}
        size: root.size
        text_size: self.width, self.height
        color: 1, 1, 1, .6
        bold: True
        spacing: 3
        text: str(round(AmbonWidget.highscore))
        background_color:
    Label:
        id: wallet_label
        pos_hint: {'x': .868, 'y': .91}
        size: root.size
        text_size: self.width, self.height
        color: 1, 1, 1, 1
        bold: True
        spacing: 3
        text: (str(round(AmbonWidget.coins_total)))
        background_color:

    Image:
        id: coin_icon
        size_hint: .06, .06
        pos_hint: {'center_x': .82, 'center_y': .925}
        source: 'resources/icons/karucoins.png'

    Image:
        id: crown_icon
        size_hint: .055, .055
        pos_hint: {'center_x': .82, 'center_y': .893}
        source: 'resources/icons/crown.png'

    Label:
        id: mainlanglabel
        text: ''
        bold: True
        font_size: 52
        pos_hint: {'center_x': .5, 'center_y': .875}
    Image:
        id: imagewidget
        source: AmbonWidget.currentImage
        opacity: 0
        size_hint: .45, .35
        pos_hint: {'center_x': .5, 'center_y': .65}
        canvas.before:
            Color:
                rgba: 1 - AmbonWidget.main_color[0], 1 - AmbonWidget.main_color[1], 1 - AmbonWidget.main_color[2], .9
            RoundedRectangle:
                size: root.width*.55, root.height*.35
                pos: self.x*.82, self.y

    Button: # Help Button
        id: help_button
        color: 0, 0, 0, 0
        background_color: 0, 0, 0, 0
        on_press: AmbonWidget.help()
        on_release: AmbonWidget.wordChecker()
        disabled: True if help_amount.text=='0' else False
        size_hint: .17, .1
        pos_hint: {"center_x": .1, "center_y": .725}
        canvas.before:
            Color:
                rgba: 1 - AmbonWidget.main_color[0], 1 - AmbonWidget.main_color[1], 1 - AmbonWidget.main_color[2], .9 # if self.state=='normal' else 0,.7,.7,1
            RoundedRectangle:
                size: help_button.size
                pos: help_button.pos
                source: 'resources/icons/suggestion.png'
    Label:
        id: help_amount
        text: str(AmbonWidget.hints)
        color: 1 - AmbonWidget.main_color[0], 1 - AmbonWidget.main_color[1], 1 - AmbonWidget.main_color[2], .9
        size: self.size
        font_size: 35
        pos_hint: {"center_x": .048, "center_y": .695}
        canvas.before:
            Color:
                rgba: (1, 1, 1, 1) if self.text!='0' else (.6, .6, .6, .75)
            Ellipse:
                size: 45, 45
                pos: help_button.x, help_button.y

    Button: # Sound Button
        id: sound_button
        color: 0, 0, 0, 0
        background_color: 0, 0, 0, 0
        clicked: 0
        disabled: True if sound_amount.text=='0' else False
        on_press: AmbonWidget.sound_used += 1; AmbonWidget.play_sound()
        size_hint: .15, .1
        pos_hint: {"center_x": .1225, "center_y": .575}
        canvas.before:
            Color:
                rgba: 1 - AmbonWidget.main_color[0], 1 - AmbonWidget.main_color[1], 1 - AmbonWidget.main_color[2], .9
            RoundedRectangle:
                size: self.size
                pos: self.pos
                source: 'resources/icons/sound.png'
    Label:
        id: sound_amount
        text: str(AmbonWidget.sound_hint)
        color: 1 - AmbonWidget.main_color[0], 1 - AmbonWidget.main_color[1], 1 - AmbonWidget.main_color[2], .9
        size: self.size
        font_size: 35
        pos_hint: {"center_x": .048, "center_y": .56}
        canvas.before:
            Color:
                rgba: (1, 1, 1, 1) if self.text!='0' else (.6, .6, .6, .9) #
            Ellipse:
                size: 45, 45
                pos: help_button.x, help_button.y*.8

    Button:
        id: pass_button
        bold: True
        color: 1, 1, 1, 1
        background_color: 0, 0, 0, 0
        on_press: AmbonWidget.skip_level(); AmbonWidget.wordChecker()
        size_hint: .12, .07
        pos_hint: {"center_x": .8875, "center_y": .65}
        canvas.before:
            Color:
                rgba: 1 - AmbonWidget.main_color[0], 1 - AmbonWidget.main_color[1], 1 - AmbonWidget.main_color[2], .9# if self.state=='normal' else 0,.7,.7,1
            RoundedRectangle:
                size: self.size
                pos: self.pos
            Color:
                rgba: (1, 1, 1, .8)
            RoundedRectangle:
                pos: self.x*1.02225, self.y*1.015
                size: self.width*.75, self.height*.75
                source: 'resources/icons/skip.png'

    GridLayout:
        rows: 3
        cols: 6
        spacing: 15, 30
        size_hint: .6, .25
        pos_hint:{"center_x":.5, "center_y":.2}

        LetterButton:
            id: LetterBtn1
            text:
            bold: True
            on_press: AmbonWidget.click_button(); AmbonWidget.i = 0; AmbonWidget.typeWord()
            on_release: AmbonWidget.wordChecker()
        LetterButton:
            id: LetterBtn2
            text:
            bold: True
            on_press: AmbonWidget.click_button(); AmbonWidget.i = 1; AmbonWidget.typeWord()
            on_release: AmbonWidget.wordChecker()
        LetterButton:
            id: LetterBtn3
            text:
            bold: True
            on_press: AmbonWidget.click_button(); AmbonWidget.i = 2; AmbonWidget.typeWord()
            on_release: AmbonWidget.wordChecker()
        LetterButton:
            id: LetterBtn4
            text:
            bold: True
            on_press: AmbonWidget.click_button(); AmbonWidget.i = 3; AmbonWidget.typeWord()
            on_release: AmbonWidget.wordChecker()
        LetterButton:
            id: LetterBtn5
            text:
            bold: True
            on_press: AmbonWidget.click_button(); AmbonWidget.i = 4; AmbonWidget.typeWord()
            on_release: AmbonWidget.wordChecker()
        LetterButton:
            id: LetterBtn6
            text:
            bold: True
            on_press: AmbonWidget.click_button(); AmbonWidget.i = 5; AmbonWidget.typeWord()
            on_release: AmbonWidget.wordChecker()
        LetterButton:
            id: LetterBtn7
            text:
            bold: True
            on_press: AmbonWidget.click_button(); AmbonWidget.i = 6; AmbonWidget.typeWord()
            on_release: AmbonWidget.wordChecker()
        LetterButton:
            id: LetterBtn8
            text:
            bold: True
            on_press: AmbonWidget.click_button(); AmbonWidget.i = 7; AmbonWidget.typeWord()
            on_release: AmbonWidget.wordChecker()
        LetterButton:
            id: LetterBtn9
            text:
            bold: True
            on_press: AmbonWidget.click_button(); AmbonWidget.i = 8; AmbonWidget.typeWord()
            on_release: AmbonWidget.wordChecker()
        LetterButton:
            id: LetterBtn10
            text:
            bold: True
            on_press: AmbonWidget.click_button(); AmbonWidget.i = 9; AmbonWidget.typeWord()
            on_release: AmbonWidget.wordChecker()
        LetterButton:
            id: LetterBtn11
            text:
            bold: True
            on_press: AmbonWidget.click_button(); AmbonWidget.i = 10; AmbonWidget.typeWord()
            on_release: AmbonWidget.wordChecker()
        LetterButton:
            id: LetterBtn12
            text:
            bold: True
            on_press: AmbonWidget.click_button(); AmbonWidget.i = 11; AmbonWidget.typeWord()
            on_release: AmbonWidget.wordChecker()
        LetterButton:
            id: LetterBtn13
            text:
            bold: True
            on_press: AmbonWidget.click_button(); AmbonWidget.i = 12; AmbonWidget.typeWord()
            on_release: AmbonWidget.wordChecker()
        LetterButton:
            id: LetterBtn14
            text:
            bold: True
            on_press: AmbonWidget.click_button(); AmbonWidget.i = 13; AmbonWidget.typeWord()
            on_release: AmbonWidget.wordChecker()
        LetterButton:
            id: LetterBtn15
            text:
            bold: True
            on_press: AmbonWidget.click_button(); AmbonWidget.i = 14; AmbonWidget.typeWord()
            on_release: AmbonWidget.wordChecker()
        LetterButton:
            id: LetterBtn16
            text:
            bold: True
            on_press: AmbonWidget.click_button(); AmbonWidget.i = 15; AmbonWidget.typeWord()
            on_release: AmbonWidget.wordChecker()
        LetterButton:
            id: LetterBtn17
            text:
            bold: True
            on_press: AmbonWidget.click_button(); AmbonWidget.i = 16; AmbonWidget.typeWord()
            on_release: AmbonWidget.wordChecker()
        LetterButton:
            id: LetterBtn18
            text:
            bold: True
            on_press: AmbonWidget.click_button(); AmbonWidget.i = 17; AmbonWidget.typeWord()
            on_release: AmbonWidget.wordChecker()

    Button:
        id: next_button
        text: ''
        opacity: 0
        on_press: AmbonWidget.click_button(); AmbonWidget.words()
        size_hint: .2, .075
        pos_hint:{"center_x":.5, "center_y":.225}
        color: (.0,.0,.0,.0) if self.disabled else (1,1,1,1)
        background_color: 0,0,0,0
        canvas.before:
            Color:
                rgba: 1 - AmbonWidget.main_color[0], 1 - AmbonWidget.main_color[1], 1 - AmbonWidget.main_color[2], .9
            RoundedRectangle:
                pos: self.pos
                size: self.size
            Color:
                rgba: (1, 1, 1, .8)
            RoundedRectangle:
                pos: self.x*1.13, self.y*1.075
                size: self.width*.5, self.height*.65
                source: 'resources/icons/next.png'
    Button:
        id: menupop
        on_press: AmbonWidget.click_button(); AmbonWidget.game_pause = True; AmbonWidget.pause_time(); Factory.PopupMenu().open()
        on_release: print(AmbonWidget.game_pause)
        background_color: 0,0,0,0
        size_hint: .12, .07
        pos_hint:{"center_x":.1, "center_y":.95}
        canvas.before:
            Color:
                rgba: 1 - AmbonWidget.main_color[0], 1 - AmbonWidget.main_color[1], 1 - AmbonWidget.main_color[2], .9# if self.state=="normal" else 0,.7,.7,1
            RoundedRectangle:
                size: menupop.size
                pos: menupop.pos
        canvas.after:
            Color:
                rgba: 1,1,1,.8
            RoundedRectangle:
                size: self.width*.65, self.height*.65
                pos: menupop.x*1.5, menupop.y*1.0125
                source: 'resources/icons/pause.png'
    Button:
        id: cd_label
        text: '3'
        font_size: 86
        bold: True
        background_color: 0, 0, 0, .3
        size: root.size
        pos: root.pos
#        on_press: AmbonWidget.start_or_menu()
#        on_release: app.root.current = 'first' if AmbonWidget.go_to_menu else print(' '); AmbonWidget.reload() if AmbonWidget.go_to_menu else print(' ')


<KaruHouse>:
    name: "third"
    orientation: 'vertical'
    size: root.width, root.height
    secondary_color: .4,.4,.4,.8
    secondary_color2: 0,.7,.7,.8

    canvas.before:
        Color:
            rgba: 1, 1, 1, 1
        Rectangle:
            pos: self.pos
            size: self.size


    Button:
        text: 'Achtergronden'
        size: root.width/2, root.height/12
        size_hint: None, None
        on_release: Factory.PopupBg().open()
        pos_hint: {"center_x":.5, "center_y":.75}
        background_color: 0, 0, 0, 0
        canvas.before:
            Color:
                rgba: root.secondary_color if self.state=='normal' else root.secondary_color2
            RoundedRectangle:
                size: self.size
                pos: self.pos

    Button:
        text: 'Categorieën'
        size: root.width/2, root.height/12
        size_hint: None, None
        on_release: Factory.PopupPacks().open()
        pos_hint: {"center_x":.5, "center_y":.65}
        background_color: 0, 0, 0, 0
        canvas.before:
            Color:
                rgba: root.secondary_color if self.state=='normal' else root.secondary_color2
            RoundedRectangle:
                size: self.size
                pos: self.pos

    Button:
        text: 'Outfits'
        size: root.width/2, root.height/12
        size_hint: None, None
        on_release: Factory.PopupOutfit().open()
        pos_hint: {"center_x":.5, "center_y":.55}
        background_color: 0, 0, 0, 0
        canvas.before:
            Color:
                rgba: root.secondary_color if self.state=='normal' else root.secondary_color2
            RoundedRectangle:
                size: self.size
                pos: self.pos


    Button:
        text: "Menu"
        font_size: 32
        on_release: app.root.current = 'first'
        size: root.width/2, root.height/12
        size_hint: None, None
        pos_hint: {"center_x":.5, "center_y":.4}
        background_color: 0, 0, 0, 0
        canvas.before:
            Color:
                rgba: root.secondary_color if self.state=='normal' else root.secondary_color2
            RoundedRectangle:
                size: self.size
                pos: self.pos

<SettingsScreen>:
    id: settings
    name: "fourth"
    orientation: 'vertical'
    size: root.width, root.height
    secondary_color: .4,.4,.4,.8
    secondary_color2: 0,.7,.7,.8
    canvas.before:
        Color:
            rgba: 1, 1, 1, 1
        Rectangle:
            pos: self.pos
            size: self.size
    Label:
        id: origin_label
        text: data.language_names[data.origin_lang]
        font_size: 36
        bold: True
        color: 1, 0, 0
        pos_hint: {'center_x':.5, 'center_y':.875}
    ScrollView:
        pos_hint: {'center_x':.5, 'center_y':.8}
        size_hint: .75, .1
        do_scroll_x: True
        do_scroll_y: False
        canvas.before:
            Color:
                rgba: (0, 0, 0, .25)
            # Rectangle is the background
            RoundedRectangle:
                pos: self.pos
                size: self.size
        GridLayout:
            id: boxlayout
            size_hint_x: None
            size_hint_y: .9
            width: root.width
            cols: 11
            rows: 1
            spacing: 20
            padding: 15, 35, 15 ,35
            ToggleButton:
                id: origin_ambon
                group: 'origins'
                language: "Ambonese"
                on_press: origin_label.text = data.language_names[self.language]; settings.origin_lang = self.language; root.choose_origin()
                size_hint: .1, .2
                background_color: 0, 0, 0, 0
                canvas.after:
                    Color:
                        rgba: (1, 1, 1, .25) if self.state=='down' else (1, 1, 1, 1)
                    Rectangle:
                        size: self.size
                        pos: self.pos
                        source: 'resources/icons/120x90/ambon.png'
            ToggleButton:
                id: origin_dutch
                group: 'origins'
                language: "Dutch"
                on_press: origin_label.text = data.language_names[self.language]; settings.origin_lang = self.language; root.choose_origin()
                size_hint: .1, .2
                background_color: 0, 0, 0, 0
                canvas.after:
                    Color:
                        rgba: (1, 1, 1, .25) if self.state=='down' else (1, 1, 1, 1)
                    Rectangle:
                        size: self.size
                        pos: self.pos
                        source: 'resources/icons/120x90/nl.png'
            ToggleButton:
                id: origin_english
                group: 'origins'
                language: "English"
                on_press: origin_label.text = data.language_names[self.language]; settings.origin_lang = self.language; root.choose_origin()
                size_hint: .1, .2
                background_color: 0, 0, 0, 0
                canvas.after:
                    Color:
                        rgba: (1, 1, 1, .25) if self.state=='down' else (1, 1, 1, 1)
                    Rectangle:
                        size: self.size
                        pos: self.pos
                        source: 'resources/icons/120x90/gb.png'
            ToggleButton:
                id: origin_german
                group: 'origins'
                language: "German"
                on_press: origin_label.text = data.language_names[self.language]; settings.origin_lang = self.language; root.choose_origin()
                size_hint: .1, .2
                background_color: 0, 0, 0, 0
                canvas.after:
                    Color:
                        rgba: (1, 1, 1, .25) if self.state=='down' else (1, 1, 1, 1)
                    Rectangle:
                        size: self.size
                        pos: self.pos
                        source: 'resources/icons/120x90/de.png'
            ToggleButton:
                id: origin_spanish
                group: 'origins'
                language: "Spanish"
                on_press: origin_label.text = data.language_names[self.language]; settings.origin_lang = self.language; root.choose_origin()
                size_hint: .1, .60
                background_color: 0, 0, 0, 0
                canvas.after:
                    Color:
                        rgba: (1, 1, 1, .25) if self.state=='down' else (1, 1, 1, 1)
                    Rectangle:
                        size: self.size
                        pos: self.pos
                        source: 'resources/icons/120x90/es.png'
            ToggleButton:
                id: origin_indonesian
                group: 'origins'
                language: "Indonesian"
                on_press: origin_label.text = data.language_names[self.language]; settings.origin_lang = self.language; root.choose_origin()
                size_hint: .1, .60
                background_color: 0, 0, 0, 0
                canvas.after:
                    Color:
                        rgba: (1, 1, 1, .25) if self.state=='down' else (1, 1, 1, 1)
                    Rectangle:
                        size: self.size
                        pos: self.pos
                        source: 'resources/icons/120x90/id.png'
            ToggleButton:
                id: origin_russian
                group: 'origins'
                language: "Russian"
                on_press: origin_label.text = data.language_names[self.language]; settings.origin_lang = self.language; root.choose_origin()
                size_hint: .1, .60
                background_color: 0, 0, 0, 0
                canvas.after:
                    Color:
                        rgba: (1, 1, 1, .25) if self.state=='down' else (1, 1, 1, 1)
                    Rectangle:
                        size: self.size
                        pos: self.pos
                        source: 'resources/icons/120x90/ru.png'
            ToggleButton:
                id: origin_french
                group: 'origins'
                language: "French"
                on_press: origin_label.text = data.language_names[self.language]; settings.origin_lang = self.language; root.choose_origin()
                size_hint: .1, .60
                background_color: 0, 0, 0, 0
                canvas.after:
                    Color:
                        rgba: (1, 1, 1, .25) if self.state=='down' else (1, 1, 1, 1)
                    Rectangle:
                        size: self.size
                        pos: self.pos
                        source: 'resources/icons/120x90/fr.png'
            ToggleButton:
                id: origin_korean
                group: 'origins'
                language: "Korean"
                on_press: origin_label.text = data.language_names[self.language]; settings.origin_lang = self.language; root.choose_origin()
                size_hint: .1, .60
                background_color: 0, 0, 0, 0
                canvas.after:
                    Color:
                        rgba: (1, 1, 1, .25) if self.state=='down' else (1, 1, 1, 1)
                    Rectangle:
                        size: self.size
                        pos: self.pos
                        source: 'resources/icons/120x90/kr.png'
            ToggleButton:
                id: origin_japanese
                group: 'origins'
                language: "Japanese"
                on_press: origin_label.text = data.language_names[self.language]; settings.origin_lang = self.language; root.choose_origin()
                size_hint: .1, .60
                background_color: 0, 0, 0, 0
                canvas.after:
                    Color:
                        rgba: (1, 1, 1, .25) if self.state=='down' else (1, 1, 1, 1)
                    Rectangle:
                        size: self.size
                        pos: self.pos
                        source: 'resources/icons/120x90/jp.png'
            ToggleButton:
                id: origin_italian
                group: 'origins'
                language: "Italian"
                on_press: origin_label.text = data.language_names[self.language]; settings.origin_lang = self.language; root.choose_origin()
                size_hint: .1, .60
                background_color: 0, 0, 0, 0
                canvas.after:
                    Color:
                        rgba: (1, 1, 1, .25) if self.state=='down' else (1, 1, 1, 1)
                    Rectangle:
                        size: self.size
                        pos: self.pos
                        source: 'resources/icons/120x90/it.png'


    Label:
        id: dest_label
        text: data.language_names[data.dest_lang]
        font_size: 36
        font_name: 'SourceHanSansHW-Bold.otf'
        bold: True
        color: 1, 0, 0
        pos_hint: {'center_x':.5, 'center_y':.675}

    ScrollView:
        pos_hint: {'center_x':.5, 'center_y':.6}
        size_hint: .75, .1
        do_scroll_x: True
        do_scroll_y: False
        canvas.before:
            Color:
                rgba: (0, 0, 0, .25)
            # Rectangle is the background
            RoundedRectangle:
                pos: self.pos
                size: self.size
        GridLayout:
            id: boxlayout2
            size_hint_x: None
            size_hint_y: .9
            width: root.width
            cols: 11
            rows: 1
            spacing: 20
            padding: 15, 35, 15 ,35
            ToggleButton:
                id: dest_ambon
                group: 'destinations'
                language: "Ambonese"
                on_press: dest_label.text = data.language_names[self.language]; settings.dest_lang = self.language; root.choose_dest()
                size_hint: .1, .2
                background_color: 0, 0, 0, 0
                canvas.after:
                    Color:
                        rgba: (1, 1, 1, .25) if self.state=='down' else (1, 1, 1, 1)
                    Rectangle:
                        size: self.size
                        pos: self.pos
                        source: 'resources/icons/120x90/ambon.png'
            ToggleButton:
                id: dest_dutch
                group: 'destinations'
                language: "Dutch"
                on_press: dest_label.text = data.language_names[self.language]; settings.dest_lang = self.language; root.choose_dest()
                size_hint: .1, .2
                background_color: 0, 0, 0, 0
                canvas.after:
                    Color:
                        rgba: (1, 1, 1, .25) if self.state=='down' else (1, 1, 1, 1)
                    Rectangle:
                        size: self.size
                        pos: self.pos
                        source: 'resources/icons/120x90/nl.png'
            ToggleButton:
                id: dest_english
                group: 'destinations'
                language: "English"
                on_press: dest_label.text = data.language_names[self.language]; settings.dest_lang = self.language; root.choose_dest()
                size_hint: .1, .2
                background_color: 0, 0, 0, 0
                canvas.after:
                    Color:
                        rgba: (1, 1, 1, .25) if self.state=='down' else (1, 1, 1, 1)
                    Rectangle:
                        size: self.size
                        pos: self.pos
                        source: 'resources/icons/120x90/gb.png'
            ToggleButton:
                id: dest_german
                group: 'destinations'
                language: "German"
                on_press: dest_label.text = data.language_names[self.language]; settings.dest_lang = self.language; root.choose_dest()
                size_hint: .1, .2
                background_color: 0, 0, 0, 0
                canvas.after:
                    Color:
                        rgba: (1, 1, 1, .25) if self.state=='down' else (1, 1, 1, 1)
                    Rectangle:
                        size: self.size
                        pos: self.pos
                        source: 'resources/icons/120x90/de.png'
            ToggleButton:
                id: dest_spanish
                group: 'destinations'
                language: "Spanish"
                on_press: dest_label.text = data.language_names[self.language]; settings.dest_lang = self.language; root.choose_dest()
                size_hint: .1, .60
                background_color: 0, 0, 0, 0
                canvas.after:
                    Color:
                        rgba: (1, 1, 1, .25) if self.state=='down' else (1, 1, 1, 1)
                    Rectangle:
                        size: self.size
                        pos: self.pos
                        source: 'resources/icons/120x90/es.png'
            ToggleButton:
                id: dest_indonesian
                group: 'destinations'
                language: "Indonesian"
                on_press: dest_label.text = data.language_names[self.language]; settings.dest_lang = self.language; root.choose_dest()
                size_hint: .1, .60
                background_color: 0, 0, 0, 0
                canvas.after:
                    Color:
                        rgba: (1, 1, 1, .25) if self.state=='down' else (1, 1, 1, 1)
                    Rectangle:
                        size: self.size
                        pos: self.pos
                        source: 'resources/icons/120x90/id.png'
            ToggleButton:
                id: dest_russian
                group: 'destinations'
                language: "Russian"
                on_press: dest_label.text = data.language_names[self.language]; settings.dest_lang = self.language; root.choose_dest()
                size_hint: .1, .60
                background_color: 0, 0, 0, 0
                canvas.after:
                    Color:
                        rgba: (1, 1, 1, .25) if self.state=='down' else (1, 1, 1, 1)
                    Rectangle:
                        size: self.size
                        pos: self.pos
                        source: 'resources/icons/120x90/ru.png'
            ToggleButton:
                id: dest_french
                group: 'destinations'
                language: "French"
                on_press: dest_label.text = data.language_names[self.language]; settings.dest_lang = self.language; root.choose_dest()
                size_hint: .1, .60
                background_color: 0, 0, 0, 0
                canvas.after:
                    Color:
                        rgba: (1, 1, 1, .25) if self.state=='down' else (1, 1, 1, 1)
                    Rectangle:
                        size: self.size
                        pos: self.pos
                        source: 'resources/icons/120x90/fr.png'
            ToggleButton:
                id: dest_korean
                group: 'destinations'
                language: "Korean"
                on_press: dest_label.text = data.language_names[self.language]; settings.dest_lang = self.language; root.choose_dest()
                size_hint: .1, .60
                background_color: 0, 0, 0, 0
                canvas.after:
                    Color:
                        rgba: (1, 1, 1, .25) if self.state=='down' else (1, 1, 1, 1)
                    Rectangle:
                        size: self.size
                        pos: self.pos
                        source: 'resources/icons/120x90/kr.png'
            ToggleButton:
                id: dest_japanese
                group: 'destinations'
                language: "Japanese"
                on_press: dest_label.text = data.language_names[self.language]; settings.dest_lang = self.language; root.choose_dest()
                size_hint: .1, .60
                background_color: 0, 0, 0, 0
                canvas.after:
                    Color:
                        rgba: (1, 1, 1, .25) if self.state=='down' else (1, 1, 1, 1)
                    Rectangle:
                        size: self.size
                        pos: self.pos
                        source: 'resources/icons/120x90/jp.png'
            ToggleButton:
                id: dest_italian
                group: 'destinations'
                language: "Italian"
                on_press: dest_label.text = data.language_names[self.language]; settings.dest_lang = self.language; root.choose_dest()
                size_hint: .1, .60
                background_color: 0, 0, 0, 0
                canvas.after:
                    Color:
                        rgba: (1, 1, 1, .25) if self.state=='down' else (1, 1, 1, 1)
                    Rectangle:
                        size: self.size
                        pos: self.pos
                        source: 'resources/icons/120x90/it.png'

    Button:
        text: "Menu"
        font_size: 32
        on_release: app.root.current = 'first'
        size: root.width/2, root.height/12
        size_hint: None, None
        pos: root.width/4, root.height/3.3
        background_color: 0, 0, 0, 0
        canvas.before:
            Color:
                rgba: root.secondary_color if self.state=='normal' else root.secondary_color2
            RoundedRectangle:
                size: self.size
                pos: self.pos