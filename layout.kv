#: kivy 2.1.0
#: import WipeTransition kivy.uix.screenmanager.WipeTransition
#:import hex kivy.utils.get_color_from_hex
#: import JsonStore kivy.storage.jsonstore
<WindowManager>:
    transition: WipeTransition()
    canvas.before:
        Color:
            rgba: 1, 1, 1, 1
        Rectangle:
            pos: self.pos
            size: self.size
    Menu:
    GameWidget:
        id: gw
    KaruHouse:
        id: kh
    SettingsScreen:


<Menu>:
    id: menu
    name: "first"
    orientation: 'vertical'
    size: root.width, root.height
    secondary_color: .4,.4,.4,1
    secondary_color2: 0,.7,.7,1
    canvas.before:
        Color:
            rgba: 1, 1, 1, 1
        Rectangle:
            pos: self.pos
            size: self.size


    Button:
	    id: start_button
        text: "Start"
        font_size: 32
        on_release: app.root.current = "second"
        size: root.width/2, root.height/12
        size_hint: None, None
        pos: root.width/4, root.height/2.5
        background_color: 0, 0, 0, 0
        canvas.before:
            Color:
                rgba: menu.secondary_color if start_button.state=='normal' else menu.secondary_color2
            RoundedRectangle:
                size: start_button.width, start_button.height
                pos: start_button.pos

    Button:
	    id: ruma_button
        text: "Karu's huis"
        font_size: 32
        on_release: app.root.current = 'third'
        size: root.width/2, root.height/12
        size_hint: None, None
        pos: root.width/4, root.height/3.3
        background_color: 0, 0, 0, 0
        canvas.before:
            Color:
                rgba: menu.secondary_color if ruma_button.state=='normal' else menu.secondary_color2
            RoundedRectangle:
                size: ruma_button.width, ruma_button.height
                pos: ruma_button.pos
    Button:
	    id: settings_button
        text: "Instellingen"
        font_size: 32
        on_release: app.root.current = 'fourth'
        size: root.width/2, root.height/12
        size_hint: None, None
        pos: root.width/4, root.height/4.8
        background_color: 0, 0, 0, 0
        canvas.before:
            Color:
                rgba: menu.secondary_color if settings_button.state=='normal' else menu.secondary_color2
            RoundedRectangle:
                size: settings_button.width, settings_button.height
                pos: settings_button.pos

    Image:
        source: 'resources/karu/karulogo.png'
        size_hint: .75, .75
        pos_hint: {'center_x': .5, 'center_y': .8}

    Label:
        size_hint: .5, .1
        pos_hint: {'center_x': .5, 'center_y': .6}
        canvas.before:
            Color:
                rgba: ((249/255), (193/255), (109/255), .8)
            RoundedRectangle:
                size: self.size
                pos: self.pos

    Label:
        id: highscore_menu
        text: str(root.highscore)
        bold: True
        pos_hint: {'center_x': .55, 'center_y': .62}

    Label:
        text: str(root.wallet)
        bold: True
        pos_hint: {'center_x': .55, 'center_y': .58}

    Image:
        size_hint: .08, .08
        pos_hint: {'center_x': .45, 'center_y': .58}
        source: 'resources/icons/karucoins.png'

    Image:
        size_hint: .08, .08
        pos_hint: {'center_x': .45, 'center_y': .62}
        source: 'resources/icons/crown.png'






<LetterButton@Button>
    background_color: 0,0,0,0  # the last zero is the critical on, make invisible
    secondary_color2: 0,.7,.7,.8
    opacity: 0
    canvas.before:
        Color:
            rgba: ((249/255), (193/255), (109/255), .8) if self.state=='normal' else (0,.7,.7,.8)  # visual feedback of press
        RoundedRectangle:
            pos: self.pos
            size: self.size

<WordButton@Button>:
    text: '_'
    bold: True
    background_color: 0, 0, 0, 0
    charpos: app.root.ids.gw.charpos
    on_press: self.text = '_'; app.root.ids.gw.charpos==self.charpos; app.root.ids.gw.backspace()
    on_release: self.state='down'
    canvas.before:
        Color:
            rgba: ((249/255), (193/255), (109/255), .8) if self.state=='normal' else (0,.7,.7,.8)  # visual feedback of press
        RoundedRectangle:
            pos: self.pos
            size: self.size

#:import Factory kivy.factory.Factory

<PopupMenu@Popup>
    auto_dismiss: False
    size_hint_y: .8
    size_hint_x: .9
    title: "Pauze"
    secondary_color: .4,.4,.4,1
    secondary_color2: 0,.7,.7,1
    gw: app.root.ids.gw

    FloatLayout:
        Slider:
            min: 0
            max: 100
            step: 1
            value: 50
            size_hint: .9, .25
            pos_hint: {'x':.05, 'y':.70}
        Slider
            min: 0
            max: 100
            step: 1
            value: 50
            size_hint: .9, .25
            pos_hint: {'x':.05, 'y':.55}
        Button:
            text: 'Menu'
            on_press: root.gw.early_stop = 1; print('early stop')
            on_release: root.gw.stop_time(); root.dismiss(); app.root.current = 'first'
            font_size: 32
            size: root.width/4, root.height/12
            size_hint: None, None
            pos_hint: {'x':.35, 'y':.25}
            background_color: 0, 0, 0, 0
            canvas.before:
                Color:
                    rgba: root.secondary_color if self.state=='normal' else root.secondary_color2
                RoundedRectangle:
                    size: self.size
                    pos: self.pos
        Button:
            text: ''
            on_press: root.gw.game_pause = False
            on_release:  root.dismiss(); root.gw.pause_time()
            font_size: 32
            size: root.width/4, root.height/12
            size_hint: None, None
            pos_hint: {'x':.35, 'y':.40}
            background_color: 0, 0, 0, 0
            canvas.before:
                Color:
                    rgba: root.secondary_color if self.state=='normal' else root.secondary_color2
                RoundedRectangle:
                    size: self.size
                    pos: self.pos
                Color:
                    rgba: 1,1,1,1
                RoundedRectangle:
                    size: self.width/2, self.height
                    pos: self.width*1.9, self.height*6
                    source: 'resources/icons/play.png'

#: import Clock kivy.clock.Clock
<PopupBg@Popup>:
    size_hint_y: .65
    size_hint_x: .8

    #kh: app.root.ids.kh
    title: ('KaruCoins: ' + str(round(self.wallet)))
    bg_btn1: bg_btn1


    bg_btn2: bg_btn2
    buy_btn2: buy_btn2

    bg_btn3: bg_btn3
    buy_btn3: buy_btn3

    on_open: Clock.schedule_once(self.update, -1); Clock.schedule_interval(self.update, .1)
    on_dismiss: Clock.unschedule(self.update)



    ScrollView:

        do_scroll_x: True
        do_scroll_y: False
        pos: root.width, root.height
        GridLayout:
            cols: 3
            rows: 2
            padding: 135, 75, 135 ,75
            spacing: 165, 25
            size_hint_y: None
            height: self.minimum_height
            size_hint_x: None
            width: self.minimum_width
            Button:
                id: bg_btn1
                on_press: root.current_bg = 1 #root.test() ; self.disabled = True; bg2.disabled = False
                on_release: root.background_change(); root.selected = 0
                font_size: 32
                size: 360/1.5, 640/1.5
                size_hint: None, None
                pos: root.width/4, root.height/6
                background_color: 0, 0, 0, 0
                canvas.before:
                    Color:
                        rgba: (1,1,1,1)# if root.bg != 'resources/backgrounds/wallpaper.png' else (0, .7, .7, .7)
                    RoundedRectangle:
                        size: self.width, self.height
                        pos: self.pos
                        source: root.packData.backgrounds[1]

            Button:
                id: bg_btn2
                disabled: True if not root.bg_unlocked['bg2'] else False
                color: 1, 1, 1, 1
                on_press: root.current_bg = 2
                on_release: root.background_change(); root.selected = 0
                font_size: 30
                size: 360/1.5, 640/1.5
                size_hint: None, None
                pos: root.width/4, root.height/6
                background_color: 0, 0, 0, 0
                canvas.before:
                    Color:
                        rgba: (1,1,1,1)# if bg_btn2.disabled==False else (1,1,1, .5)
                    RoundedRectangle:
                        size: self.width, self.height
                        pos: self.pos
                        source: root.packData.backgrounds[2]
                canvas.after:
                    Color:
                        rgba: (1,1,1,0) if bg_btn2.disabled==False else (115/255,115/255,115/255, .9)
                    RoundedRectangle:
                        size: self.width, self.height
                        pos: self.pos

            Button:
                id: bg_btn3
                disabled: True if not root.bg_unlocked['bg3'] else False
                color: 1, 1, 1, 1
                on_press: root.current_bg = 3# root.test()#; self.disabled = True; bg1.disabled = False
                on_release: root.background_change(); root.selected = 0
                font_size: 30
                size: 360/1.5, 640/1.5
                size_hint: None, None
                pos: root.width/4, root.height/6
                background_color: 0, 0, 0, 0
                canvas.before:
                    Color:
                        rgba: (1,1,1,1) #if bg_btn3.disabled==False else (1,1,1, .3)
                    RoundedRectangle:
                        size: self.width, self.height
                        pos: self.pos
                        source: root.packData.backgrounds[3]
                canvas.after:
                    Color:
                        rgba: (1,1,1,0) if bg_btn3.disabled==False else (115/255,115/255,115/255, .9)
                    RoundedRectangle:
                        size: self.width, self.height
                        pos: self.pos

            Button:
                id: buy_btn1
                disabled: True
                text: root.price_str if not root.bg_unlocked['bg1'] else 'Gekocht'
                bold: True
                background_color: 0, 0, 0, 0
                pos: self.pos
                size_hint: None, None
                size: 360/1.5, 640/8
                canvas.before:
                    Color:
                        rgba: 0,.7,.7,1
                    RoundedRectangle:
                        pos: self.pos
                        size: self.size

            Button:
                id: buy_btn2
                disabled: False if not root.bg_unlocked['bg2'] else True
                text: root.price_str if not root.bg_unlocked['bg2'] else 'Gekocht'
                bold: True
                on_press: root.current_bg = 2; # root.test()#; self.disabled = True; bg1.disabled = False; bg3.disabled = False
                on_release: root.background_change()
                background_color: 0, 0, 0, 0
                pos: self.pos
                size_hint: None, None
                size: 360/1.5, 640/8
                canvas.before:
                    Color:
                        rgba: (0,.7,.7,1) if self.state=='normal' else (0,.7,.7,.7)
                    RoundedRectangle:
                        pos: self.pos
                        size: self.size

            Button:
                id: buy_btn3
                disabled: False if not root.bg_unlocked['bg3'] else True
                text: root.price_str if not root.bg_unlocked['bg3'] else 'Gekocht'
                bold: True
                on_press: root.current_bg = 3; # root.test()#; self.disabled = True; bg1.disabled = False; bg3.disabled = False
                on_release: root.background_change()
                background_color: 0, 0, 0, 0
                pos: self.pos
                size_hint: None, None
                size: 360/1.5, 640/8
                canvas.before:
                    Color:
                        rgba: (0,.7,.7,1) if self.state=='normal' else (0,.7,.7,.7)
                    RoundedRectangle:
                        pos: self.pos
                        size: self.size


<PopupOutfit@Popup>:
    size_hint_y: .5
    size_hint_x: .8
    kh: app.root.ids.kh
    title: ('KaruCoins: ' + str(round(self.kh.wallet)))

    BoxLayout:
        spacing: 15
        Button:
            text: "Coming soon..."
            bold: True
            on_press: print('COMING SOON')
            font_size: 32
            size: root.width/6, root.height/4
            size_hint: None, None
            pos: root.width/4, root.height/1.5
            background_color: 0, 0, 0, .7



<GameWidget>:

    size: root.size
    pos: root.pos
    bg: self.bg
    canvas.before:
        Color:
            rgba: 1, 1, 1, 1
        Rectangle:
            pos: self.pos
            size: self.size
            source: self.bg
    name: "second"


    karulabel: karulabel
    highscore_label: highscore_label
    wallet_label: wallet_label

    secondary_color: .4,.4,.4,1
    secondary_color2: 0,.7,.7,1

    letterBtn1: LetterBtn1
    letterBtn2: LetterBtn2
    letterBtn3: LetterBtn3
    letterBtn4: LetterBtn4
    letterBtn5: LetterBtn5
    letterBtn6: LetterBtn6
    letterBtn7: LetterBtn7
    letterBtn8: LetterBtn8
    letterBtn9: LetterBtn9
    letterBtn10: LetterBtn10
    letterBtn11: LetterBtn11
    letterBtn12: LetterBtn12

    next_button: next_button

    help_button: help_button
    start_btn: start_btn

    imagewidget: imagewidget

    i: 0

    id: AmbonWidget

    canvas:
        Color:
            rgba: ((249/255), (193/255), (109/255), .8)
        RoundedRectangle:
            pos: root.width/1.3, root.height/1.15
            size: root.width/3, root.height/9

    Label:
        pos_hint: {'x': .868, 'y': .938}
        size: root.size
        text_size: self.width, self.height
        color: 1, 1, 1
        bold: True
        spacing: 3
        text: str(round(AmbonWidget.score))
        background_color:
    Label:
        id: highscore_label
        pos_hint: {'x': .868, 'y': .878}
        size: root.size
        text_size: self.width, self.height
        color: 1, 1, 1, .6
        bold: True
        spacing: 3
        text: str(round(AmbonWidget.highscore))
        background_color:
    Label:
        id: wallet_label
        pos_hint: {'x': .868, 'y': .91}
        size: root.size
        text_size: self.width, self.height
        color: 1, 1, 1, 1
        bold: True
        spacing: 3
        text: (str(round(AmbonWidget.coins_total)))
        background_color:

    Image:
        size_hint: .06, .06
        pos_hint: {'center_x': .82, 'center_y': .925}
        source: 'resources/icons/karucoins.png'

    Image:
        size_hint: .06, .06
        pos_hint: {'center_x': .82, 'center_y': .893}
        source: 'resources/icons/crown.png'


    Image:
        id: imagewidget
        source: AmbonWidget.currentImage
        opacity: 0
        size_hint: .5, .5
        pos_hint: {'center_x': .5, 'center_y': .65}
        canvas.before:
            Color:
                rgba: ((249/255), (193/255), (109/255), .8)
            RoundedRectangle:
                size: 350, 350
                pos: root.width/3.85, root.height/1.95

    Button: # Help Button
        id: help_button
        color: 0, 0, 0, 0
        background_color: 0, 0, 0, 0
        on_press: AmbonWidget.help()
        size_hint: .7, .175
        pos_hint: {"center_x": .5, "center_y": .125}


    Label:
        id: karulabel
        color: 1,1,1
        text: AmbonWidget.karu.speech
        multiline: True
        bold: True
        font_size: 30 #root.width*.045
        text_size: self.size
        size_hint: .4, .175
        pos_hint:{"center_x": .6, "center_y": .2}
        canvas.before:
            Color:
                rgba: ((249/255), (193/255), (109/255), .8) if help_button.state=='normal' else (AmbonWidget.secondary_color2)
            RoundedRectangle:
                size: help_button.size
                pos: help_button.pos

    Image:
        source: 'resources/karu/karu.png'
        size_hint: .2, .2
        pos_hint:{"center_x":.27, "center_y":.125}



    GridLayout:
        rows: 3
        cols: 6
        spacing: 15, 30
        size_hint: .5, .15
        pos_hint:{"center_x":.5, "center_y":.3}

        LetterButton:
            id: LetterBtn1
            text:
            bold: True
            on_press: AmbonWidget.i = 0; AmbonWidget.typeWord()
            on_release: AmbonWidget.wordChecker()
        LetterButton:
            id: LetterBtn2
            text:
            bold: True
            on_press: AmbonWidget.i = 1; AmbonWidget.typeWord()
            on_release: AmbonWidget.wordChecker()
        LetterButton:
            id: LetterBtn3
            text:
            bold: True
            on_press: AmbonWidget.i = 2; AmbonWidget.typeWord()
            on_release: AmbonWidget.wordChecker()
        LetterButton:
            id: LetterBtn4
            text:
            bold: True
            on_press: AmbonWidget.i = 3; AmbonWidget.typeWord()
            on_release: AmbonWidget.wordChecker()
        LetterButton:
            id: LetterBtn5
            text:
            bold: True
            on_press: AmbonWidget.i = 4; AmbonWidget.typeWord()
            on_release: AmbonWidget.wordChecker()
        LetterButton:
            id: LetterBtn6
            text:
            bold: True
            on_press: AmbonWidget.i = 5; AmbonWidget.typeWord()
            on_release: AmbonWidget.wordChecker()
        LetterButton:
            id: LetterBtn7
            text:
            bold: True
            on_press: AmbonWidget.i = 6; AmbonWidget.typeWord()
            on_release: AmbonWidget.wordChecker()
        LetterButton:
            id: LetterBtn8
            text:
            bold: True
            on_press: AmbonWidget.i = 7; AmbonWidget.typeWord()
            on_release: AmbonWidget.wordChecker()
        LetterButton:
            id: LetterBtn9
            text:
            bold: True
            on_press: AmbonWidget.i = 8; AmbonWidget.typeWord()
            on_release: AmbonWidget.wordChecker()
        LetterButton:
            id: LetterBtn10
            text:
            bold: True
            on_press: AmbonWidget.i = 9; AmbonWidget.typeWord()
            on_release: AmbonWidget.wordChecker()
        LetterButton:
            id: LetterBtn11
            text:
            bold: True
            on_press: AmbonWidget.i = 10; AmbonWidget.typeWord()
            on_release: AmbonWidget.wordChecker()
        LetterButton:
            id: LetterBtn12
            text:
            bold: True
            on_press: AmbonWidget.i = 11; AmbonWidget.typeWord()
            on_release: AmbonWidget.wordChecker()
    Button:
        id: next_button
        text: '>'
        opacity: 0
        on_press: AmbonWidget.words()
        size_hint: .2, .05
        pos_hint:{"center_x":.5, "center_y":.3}
        color: (.0,.0,.0,.0) if self.disabled else (1,1,1,1)
        background_color: 0,0,0,0
        canvas.before:
            Color:
                rgba: (.021,.4,.006,.8) if self.state=='normal' else (.021,.4,.006,.9)  # visual feedback of press
            RoundedRectangle:
                pos: self.pos
                size: self.size
    Button:
        id: menupop
        on_press: AmbonWidget.game_pause = True; AmbonWidget.pause_time(); Factory.PopupMenu().open()
        on_release: print(AmbonWidget.game_pause)
        background_color: 0,0,0,0
        size_hint: .1, .05
        pos_hint:{"center_x":.1, "center_y":.94}
        canvas.before:
            Color:
                rgba: ((249/255), (193/255), (109/255), .8) if self.state=='normal' else AmbonWidget.secondary_color2
            RoundedRectangle:
                size: menupop.size
                pos: menupop.pos
        canvas.after:
            Color:
                rgba: 1,1,1,1
            RoundedRectangle:
                size: menupop.size
                pos: menupop.pos
                source: 'resources/icons/pause.png'
    Button:
        id: start_btn
        text: 'Raak het scherm aan\n   om te beginnen!'
        bold: True
        background_color: 0, 0, 0, .3
        size: root.size
        pos: root.pos
        on_press: AmbonWidget.start_or_menu()#; AmbonWidget.game_pause = False; Clock.schedule_interval(AmbonWidget.menu_checker, .1)#; AmbonWidget.pause()
        on_release: app.root.current = 'first' if AmbonWidget.go_to_menu else print(' '); AmbonWidget.reload() if AmbonWidget.go_to_menu else print(' ')


<KaruHouse>:
    name: "third"
    orientation: 'vertical'
    size: root.width, root.height
    secondary_color: .4,.4,.4,.8
    secondary_color2: 0,.7,.7,.8

    canvas.before:
        Color:
            rgba: 1, 1, 1, 1
        Rectangle:
            pos: self.pos
            size: self.size


    Button:
        text: 'Achtergronden'
        size: root.width/2, root.height/12
        size_hint: None, None
        on_release: Factory.PopupBg().open()
        pos: root.width/4, root.height/1.5
        background_color: 0, 0, 0, 0
        canvas.before:
            Color:
                rgba: root.secondary_color if self.state=='normal' else root.secondary_color2
            RoundedRectangle:
                size: self.size
                pos: self.pos

    Button:
        text: 'Outfits'
        size: root.width/2, root.height/12
        size_hint: None, None
        on_release: Factory.PopupOutfit().open()
        pos: root.width/4, root.height/2
        background_color: 0, 0, 0, 0
        canvas.before:
            Color:
                rgba: root.secondary_color if self.state=='normal' else root.secondary_color2
            RoundedRectangle:
                size: self.size
                pos: self.pos





    Button:
        text: "Menu"
        font_size: 32
        on_release: app.root.current = 'first'
        size: root.width/2, root.height/12
        size_hint: None, None
        pos: root.width/4, root.height/3.3
        background_color: 0, 0, 0, 0
        canvas.before:
            Color:
                rgba: root.secondary_color if self.state=='normal' else root.secondary_color2
            RoundedRectangle:
                size: self.size
                pos: self.pos

<SettingsScreen>:
    name: "fourth"
    orientation: 'vertical'
    size: root.width, root.height
    secondary_color: .4,.4,.4,.8
    secondary_color2: 0,.7,.7,.8
    canvas.before:
        Color:
            rgba: 1, 1, 1, 1
        Rectangle:
            pos: self.pos
            size: self.size


    Button:
        text: "Menu"
        font_size: 32
        on_release: app.root.current = 'first'
        size: root.width/2, root.height/12
        size_hint: None, None
        pos: root.width/4, root.height/3.3
        background_color: 0, 0, 0, 0
        canvas.before:
            Color:
                rgba: root.secondary_color if self.state=='normal' else root.secondary_color2
            RoundedRectangle:
                size: self.size
                pos: self.pos